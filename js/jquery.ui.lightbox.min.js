(function(){$.widget("ui.lightbox",{options:{boxId:"lightbox",closeButtonId:"hideBox",wrapperId:"lightbox-wrapper",bgId:"lightbox-bg",action:false,drag:true,data:{},method:"GET",beforeLoad:function(a,b){},afterLoad:function(a){},afterClose:function(a){}},_create:function(){if($("#"+this.options.wrapperId).length===0){this.options.$wrapper=$("<div/>",{id:this.options.wrapperId}).appendTo("body")}else{this.options.$wrapper=$("#"+this.options.wrapperId)}if($("#"+this.options.bgId).length===0){return this.options.$bg=$("<div/>",{id:this.options.bgId}).appendTo("body")}else{return this.options.$bg=$("#"+this.options.bgId)}},_init:function(){var a;a=this;return this.element.click(function(){if($(this).attr("id")){a.options.data.element_id=$(this).attr("id").split("_")[1]}a.options.beforeLoad(this,a);if($(this).attr("href")!==void 0&&!a.options.action){if($(this).attr("href").length>1){a.options.action=$(this).attr("href")}}a._load();return false})},_load:function(){var a;a=this;this.options.$wrapper.css("height",$(document).height()+"px").fadeIn("slow");this.options.$bg.css("height",$(document).height()+"px").fadeIn("slow");if(this.options.action){return $.ajax({url:this.options.action,data:this.options.data,complete:function(b,c){var d;a.options.$wrapper.html(b.responseText);d=$(window).scrollTop()+$(window).height()*25/100;$("#"+a.options.boxId).css("top",d+"px").fadeIn("slow");a.options.afterLoad(a);return a._initBox()},dataType:"json",type:a.options.method})}},_initBox:function(){var a;a=this;if(this.options.drag){$("#"+this.options.boxId).draggable({handle:"header"})}this.options.$wrapper.click(function(){return a.close()});$("#"+this.options.boxId).click(function(a){return a.stopPropagation()});return $("#"+this.options.closeButtonId).click(function(){a.close();return false})},close:function(){var a;a=this;return $("#"+this.options.boxId).fadeOut("slow",function(){a.options.$wrapper.fadeOut("slow");a.options.$bg.fadeOut("slow");$(this).remove();a.options.$wrapper.unbind();return a.options.afterClose(a)})},destroy:function(){this.element.unbind("click");this.options.$bg.remove();return this.options.$wrapper.remove()}})}).call(this)